<div class="space-y-6">

  <!-- HEADER -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-gray-800">
      Flujo de Etapas del Proceso
    </h1>

    <button
      (click)="agregar()"
      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow"
    >
      + Agregar etapa
    </button>
  </div>

  <!-- LOADING -->
  @if (loading()) {
    <div class="text-gray-500">
      Cargando flujo...
    </div>
  }

  <!-- LISTA -->
  @else {

    <div
      class="bg-white rounded shadow divide-y"
      cdkDropList
      (cdkDropListDropped)="drop($event)"
    >

      @for (etapa of etapas(); track etapa.iId) {

        <div
          class="flex items-center justify-between px-4 py-3 hover:bg-gray-50"
          cdkDrag
        >

          <!-- INFO -->
          <div>
            <div class="font-medium text-gray-800">
              {{ etapa.cNombreEtapa }}
            </div>

            <div class="text-xs text-gray-500 space-x-2">
              @if (etapa.lEsInicial) {
                <span class="text-green-600 font-semibold">
                  Inicial
                </span>
              }
              @if (etapa.lEsFinal) {
                <span class="text-red-600 font-semibold">
                  Final
                </span>
              }
            </div>
          </div>

          <!-- ACCIONES -->
          <div class="flex items-center gap-4">

            <!-- DRAG HANDLE -->
            <span
              cdkDragHandle
              class="cursor-move text-gray-400 select-none"
              title="Arrastrar para reordenar"
            >
              â˜°
            </span>

            <button
              (click)="eliminar(etapa.iId)"
              class="text-red-600 hover:underline text-sm"
            >
              Quitar
            </button>

          </div>

        </div>
      }

      <!-- EMPTY -->
      @if (etapas().length === 0) {
        <div class="p-6 text-center text-gray-500">
          No hay etapas configuradas para este proceso.
        </div>
      }

    </div>
  }
</div>
